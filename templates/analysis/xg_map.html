{% extends "base.html" %}

{% block title %}xG Map - {{ season.competition.name }} {{ season.name }}{% endblock %}
{% block extra_css %}
<style>
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
</style>
{% endblock %}


{% block content %}
<h1>XG Map</h1>

<form method="get" style="margin-bottom:24px;">
  <label for="competition"><strong>Competition:</strong></label>
  <select name="competition" id="competition">
    {% for c in competitions %}
      <option value="{{ c.id }}"
        {% if c.id == selected_season.competition.id %}selected{% endif %}>
        {{ c.name }}
      </option>
    {% endfor %}
  </select>
  <label for="season"><strong>Season:</strong></label>
  <select name="season" id="season">
    {% for s in seasons %}
      {% if s.competition.id == selected_season.competition.id %}
      <option value="{{ s.id }}"
        {% if s.id == selected_season.id %}selected{% endif %}>
        {{ s.name }}
      </option>
      {% endif %}
    {% endfor %}
  </select>
  <button type="submit">Filter</button>
</form>

<h1>
    xG Map - {{ selected_season.competition.name }} {{ selected_season.name }}
</h1>
<div style="width: 100%;">
  <canvas id="xgScatter" height="100"></canvas>
</div>
{% endblock %}


{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const teams = {{ teams|safe }};
const xgf = {{ xgf|safe }};
const xga = {{ xga|safe }};

const data = teams.map((team, i) => ({
  label: team,
  data: [{ x: xgf[i], y: xga[i] }]
}));

const ctx = document.getElementById("xgScatter").getContext("2d");

new Chart(ctx, {
  type: "scatter",
  data: {
    datasets: data
  },
  options: {
    plugins: {
      tooltip: {
        callbacks: {
          label: ctx =>
            ctx.dataset.label +
            ": xGF=" + ctx.raw.x +
            ", xGA=" + ctx.raw.y
        }
      }
    },
    scales: {
      x: {
        title: { display: true, text: "xG For (Attacking Strength)" }
      },
      y: {
        title: { display: true, text: "xG Against (Defensive Weakness)" },
        reverse: true
      }
    }
  }
});
</script>
{% endblock %}